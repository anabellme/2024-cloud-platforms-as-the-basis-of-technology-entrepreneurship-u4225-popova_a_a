University: [ITMO University](https://itmo.ru/ru/)

Faculty: [FTMI](https://ftmi.itmo.ru/)

Course: [Cloud platforms as the basis of technology entrepreneurship](https://itmo-ict-faculty.github.io/cloud-platforms-as-the-basis-of-technology-entrepreneurship/) 

Year: 2024

Group: U4225

Author: Popova Anna Andreevna

Lab: Lab2

Date of create: 25.10.2024

Date of finished: 25.10.2024

# Лабораторная работа №2: "Исследование Cloud Run"

## Цель работы:
Познакомиться с основами сервиса Google Cloud Run, протестировать его основные возможности, научиться работать с логами и метриками, а также провести эксперименты с изменением порта и переключением трафика между версиями.

## Ход работы:

### 1. Создание сервиса Cloud Run на основе шаблона Hello
Использовала Google Cloud Console для создания нового сервиса Cloud Run на основе дефолтного образа Hello. Был выбран общедоступный доступ для тестирования без авторизации. После успешного деплоя Cloud Run предоставил URL-адрес, по которому можно перейти и протестировать работу сервиса.

<img width="1345" alt="image" src="https://github.com/user-attachments/assets/63e86151-80f2-4a84-a8ea-15410cfac697">

### 2. Тестирование работы сервиса
- Открыла предоставленный URL в браузере;
- При запуске сервиса увидела дефолтное приветственное сообщение "Hello, World!";
- Убедились, что Cloud Run работает корректно с минимальными ресурсами.

<img width="854" alt="image" src="https://github.com/user-attachments/assets/f8294fa5-43f7-4c67-8ed3-6e096abcd58c">

### 3. Анализ логов и метрик

#### Просмотр логов
Перешла в раздел Logs через интерфейс Cloud Run. Проанализировала логи, которые включали информацию о каждом запросе, времени отклика и состоянии выполнения.
Логи не содержали ошибок, что подтверждает корректную работу сервиса.

<img width="1309" alt="image" src="https://github.com/user-attachments/assets/144fafdb-d0be-49ec-9c67-4f2b00146432">

#### Анализ метрик
Перешла в раздел Metrics в консоли Cloud Run.

Обратила внимание на такие показатели, как:
- Latency (задержка) — низкие значения, что говорит о быстрой обработке запросов.
- CPU Usage и Memory Usage — использовались в пределах заданных лимитов.

Эти метрики позволяют понять, как сервис обрабатывает запросы, и насколько эффективно используются ресурсы, выделенные Cloud Run.

<img width="1708" alt="image" src="https://github.com/user-attachments/assets/ce74b6d2-6c2b-4bd8-8a81-14ce97ec96d6">

### 4. Изменение порта сервиса

Изменила конфигурацию Cloud Run, установив порт 8090, поменяв с 8080.
Перезапустила сервис с новой версией.

Сервис успешно заработал на новом порте. Важно отметить, что в Cloud Run автоматически осуществляется маршрутизация, поэтому URL остался прежним, а изменения коснулись только внутренней настройки.
Проверила работу сервиса после изменения порта, чтобы убедиться в корректной обработке запросов.

<img width="1684" alt="image" src="https://github.com/user-attachments/assets/4a868bf6-a762-4703-ac4e-a6d9b61f1278">

### 5. Переключение трафика между версиями

В разделе Revisions распределила трафик между старой и новой версиями (50% на версию с портом 8080 и 50% на версию с портом 8090). Выполнила тестовые запросы для проверки распределения трафика между версиями. В логах отразилась работа обеих версий, что подтвердило корректное распределение трафика. При переходе по URL несколько раз были замечены отличия в ответах, что указывало на то, что запросы обрабатываются обоими версиями.

<img width="863" alt="image" src="https://github.com/user-attachments/assets/3e023689-47df-41bf-9ede-2063c165378b

Сравнение метрик показало, что обе версии обрабатывают запросы одинаково, без значительных различий в производительности.

#### Преимущества и особенности переключения трафика:
- Возможность направить только часть трафика на новую версию позволяет снизить риски при развертывании обновлений, особенно если они содержат значительные изменения.
- В процессе переключения трафика можно анализировать поведение новых изменений на небольшой группе пользователей, проверяя логи и метрики для обеих версий. Это помогает оперативно выявить и устранить потенциальные ошибки.
- Если новая версия показывает сбои, то в любой момент можно быстро перенаправить весь трафик обратно на стабильную версию, избегая долгих простоев.
- Cloud Run автоматически масштабирует как старую, так и новую версии по мере роста нагрузки, что позволяет не беспокоиться о производительности при тестировании изменений на части трафика.

## Выводы:

### Результаты лабораторной работы

- В ходе выполнения работы был успешно развернут сервис на Cloud Run.
- Проведено тестирование работы сервиса, настройка минимального уровня ресурсов.
- Проанализированы логи и метрики, что дало представление о производительности и нагрузке на сервис.
- Проверено поведение сервиса при изменении порта — было установлено, что Cloud Run поддерживает работу с портом 8080 по умолчанию.
- Проведен эксперимент с переключением трафика между версиями, что продемонстрировало гибкость Cloud Run в управлении трафиком и версиями.

Cloud Run предоставляет мощные возможности для развертывания контейнеризированных приложений с минимальными усилиями и высокой гибкостью в управлении версиями и трафиком. Сервис автоматически масштабируется под нагрузку, при этом сохраняется простота настройки и управления.






