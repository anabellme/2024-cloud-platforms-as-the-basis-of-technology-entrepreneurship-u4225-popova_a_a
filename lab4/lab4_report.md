**University**: [ITMO University](https://itmo.ru/ru/)

**Faculty**: [FTMI](https://ftmi.itmo.ru/)

**Course**: [Cloud platforms as the basis of technology entrepreneurship](https://itmo-ict-faculty.github.io/cloud-platforms-as-the-basis-of-technology-entrepreneurship/) 

**Year**: 2024

**Group**: U4225

**Author**: Popova Anna Andreevna

**Lab**: Lab4

**Date of create**: 04.11.2024

**Date of finished**: 04.11.2024

# Лабораторная работа №3: "Разработка инфраструктуры MVP AI приложения"

## Цель работы:
Создание и эксплуатация чат-бота для расшифровки раскладов Таро с использованием AI-модели GigaChat.

## Ход работы:
Разработать чат-бота для Telegram, который будет отвечать на запросы пользователей по интерпретации карт Таро, используя API GigaChat. Определить оптимальную инфраструктуру для развертывания и посчитать экономическую модель.

## Задачи

#### 1. Реализация функционала
Создать бот, который
- принимает вопросы от пользователей;
- использует API GigaChat для получения интерпретации;
- ограничивает количество запросов для пользователей, с возможностью пополнения лимита (подписка).
#### 2. Создание инфраструктуры
- спроектировать инфраструктуру бота;
- нарисовать схему архитектуры.
#### 3. Расчет экономической модели
- определить расходы для каждого из этапов: начальный, тестирование партнёрами, продакшн;
- обосновать выбор используемых ресурсов.

## Ход работы

### 1. Описание функционала бота

Бот работает по следующей логике:
- пользователь отправляет вопрос о Таро через Telegram;
- бот проверяет наличие доступных запросов у пользователя;
- если запросы еще не исчерпаны, бот запрашивает у пользователя карты, которые следует интерпретировать или дает возможность рандомно получить карты для ответа на вопрос;
- полученные данные передаются в API GigaChat для интерпретации;
- бот получает и отправляет пользователю расшифровку расклада.

#### **Основные функции и компоненты**:

- **Подключение к базе данных MySQL** для хранения данных о пользователях и ограничениях по запросам.
- **Обращение к API GigaChat** для генерации текстового ответа по запросу пользователя.
- **Кэширование** часто запрашиваемых данных с использованием Redis для экономии на запросах в GigaChat API.
  
### 2. Схема инфраструктуры бота
Была разработана следующая инфраструктура, обеспечивающая стабильность, отказоустойчивость и масштабируемость.

<img width="597" alt="image" src="https://github.com/user-attachments/assets/96ad6f58-2fda-4225-a788-2d112b0df9ef">


### 3. Экономическая модель

#### Этапы:
1. **Начальный этап**: Используется минимальная инфраструктура для разработки и первичного тестирования.
2. **Этап тестирования партнёрами**: Повышается нагрузка за счет партнёров и узкого круга пользователей. Используются более мощные серверы и подключается базовый Load Balancer для распределения нагрузки.
3. **Продакшн**: Максимальная стабильность и масштабируемость. Внедряются отказоустойчивые решения, распределённая база данных и полноценное кэширование для ускорения работы и снижения затрат на API.

<img width="735" alt="image" src="https://github.com/user-attachments/assets/0b6c8712-9292-430a-97f7-b2ddc87118e7">


### Обоснование выбора ресурсов

#### 1. Виртуальные машины и автоскейлинг

**Для начального этапа** достаточно одной виртуальной машины с базовой конфигурацией.

На этапе **тестирования партнерами** будут нагружать систему, поэтому добавляется второй сервер, чтобы предотвратить перегрузку.

В **продакшн-среде** используется автоскейлинг, который динамически добавляет ресурсы при росте нагрузки, что позволяет эффективно управлять затратами и повышать устойчивость.

#### 2. MySQL

**В начальном этапе** база данных запускается локально на сервере, что снижает расходы.

На этапе **тестирования** и в **продакшн-среде MySQL** размещается на AWS RDS с обеспечением отказоустойчивости.

В **продакшн-среде** используется Multi-AZ для повышения устойчивости к сбоям, что обоснованно при повышенной нагрузке.

#### 3. Redis для кэширования

Redis ускоряет ответы на популярные запросы и уменьшает число обращений к GigaChat API, что снижает расходы.

В **тестовом и продакшн-режимах** Managed Redis используется для удобного управления и масштабирования.

#### 4. Load Balancer

На этапе **тестирования добавляется** базовый балансировщик для распределения нагрузки между двумя серверами.

В **продакшн-режиме** балансировщик поддерживает автоскейлинг и распределение запросов между API-серверами для обеспечения высокой доступности.

#### 5. GigaChat API

**В начальном этап**е запросы ограничены, чтобы снизить расходы.

В **продакшн-режиме** на GigaChat API приходится значительная часть затрат, так как обрабатываются большие объемы запросов. Однако кэширование через Redis помогает снизить общее число обращений.

#### 6. Мониторинг и логирование (Grafana)

**В начальном этапе** используется базовая конфигурация (1 vCPU, 1 GB RAM), достаточная для разработки и начального тестирования.

На этапе **тестирования партнёрами** для мониторинга увеличенной нагрузки конфигурация масштабируется до 2 vCPU и 4 GB RAM.

Увеличение ресурсов до 2 vCPU и 8 GB RAM позволяет обеспечить стабильную работу мониторинга и логирования в условиях высокой нагрузки на этапе **продакшена**.

## Выводы

Предложенная инфраструктура позволяет оптимизировать затраты на каждом этапе. Использование Load Balancer, Redis для кэширования, автоскейлинга и распределенной базы данных позволяет эффективно масштабировать бота по мере увеличения нагрузки и снижать затраты на платные API-запросы, обеспечивая при этом стабильную работу приложения.
